#!/bin/sh

set -e

#
# Skip, if we are not in "configure" state
#
if [ "$1" != "configure" ]; then
    echo "I: Skipping configuration"
    exit 0
fi


#
#  If there is no volatile then add it.
#
if ( ! grep volatile /etc/apt/sources.list 2>/dev/null >/dev/null ); then
    cat >> /etc/apt/sources.list <<EOF

deb     http://mirror.bytemark.co.uk/debian-volatile/ stable/volatile main contrib non-free
deb-src http://mirror.bytemark.co.uk/debian-volatile/ stable/volatile main contrib non-free
EOF

fi

#
#  Fix all perms
#
for i in /srv /srv/* ; do
    if [ -e $i ]; then
        if [ -d $i ] ; then
            owner=`stat --format='%U.%G' $i`
            if [ "$owner" = "root.root" ]; then
                chown -R admin:admin $i
            fi
        fi
    fi
done

#
#  Update /etc/motd.
#
uname -snrvm > /etc/motd
cat >>/etc/motd<<EOF

To access the Bytemark Symbiosis documentation, please visit:

  * http://symbiosis.bytemark.co.uk/

EOF


#DEBHELPER#
exit 0
