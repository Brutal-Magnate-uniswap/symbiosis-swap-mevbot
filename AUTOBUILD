Autobuilding
------------

To provide a means of continuous integration we need to have some system
in place which will easily allow ourselves (and others) to automatically
checkout the current repository and execute a build of our packages.

This build-process should be 100% automatic, and should allow us to be
alerted of failures via Email notications.


Assumptions
-----------

It is assumed that the starting point for an auto-build will be a
debootstrap produced installation of Debian.

The only tools required by default will be:

  * make to build the code.
  * mercurial to fetch the source.
  * The minimal Debian package building-utilities.

The chroot will be created like so:



   # packages=dpkg-dev,devscripts,build-essential,fakeroot,make,mercurial,perl-modules
   # debootstrap --include=$packages lenny /tmp/lenny http://mirror.bytemark.co.uk/debian


Given that chroot environment we should be able to fetch and build the
most recent version of the Symbiosis project via:

   # chroot /tmp/lenny hg clone http://projects.bytemark.co.uk/hg/Symbiosis  || echo "failed"

   # chroot /tmp/lenny make -C /Symbiosis all || echo "FAILED"

The expected result will be that /Symbiosis/output will contain :

  * A collection of binary packages.
  * A collection of source packages.
  * A "Packages.gz" file, and "Sources.gz" file.

It will also know how to send email on the event of failure.



Steps for Autobuilding and C-I
==============================

* Use old dedicated (AMD64) box as a autobuild host

* Post-commit hook to build packages on autobuild host
  --> email dev-list on error

* If the build succeeds,  create new dated repo with packages.
  --> Link /autobuild/current -> /autobuild/YYYYMMDD-HH:MM so that
  the most recent is available.
  --> Remove builds older than one month.

* Deploy a new VM on the machine, using the current Symbiosis image on the
  imager.

* Once installed, and upgraded to the current stable packages, run tests.
  --> email dev-list if these tests fail

* If tests pass, upgrade to newly built packages, run tests
  --> email dev-list if these tests fail

* If tests pass, remove machine.


