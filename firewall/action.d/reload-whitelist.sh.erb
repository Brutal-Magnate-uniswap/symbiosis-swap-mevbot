#!/bin/bash
#
#
########################################################################
#
# Firewall rules created by <%= $0 %> 
#
########################################################################

#
# exit nicely.
#
set -e

% if $DEBUG
#
# Be verbose
#
set -v
% end

#
# Create black/whitelist rules
# 
% chain = "whitelist"
for cmd in <%= iptables_cmds.join(" ") %> ; do
  #
  # See if the chain exists, create if not.
  #
  $cmd -n -L <%= chain %> > /dev/null 2>&1 || $cmd -N <%= chain%> 

  # 
  # Flush the chain, just in case it already existed.
  #
  $cmd  -F <%= chain %> 
done

%   dir  = File.join(base_dir, "#{chain}.d")
%   next unless File.directory?(dir)
%   next if File.exists?(File.join(dir,"disabled.#{chain}")) or File.exists?(File.join(dir,"disabled"))
%   list = IPListDirectory.new(dir, "incoming", chain)
%   list.default = chain
<%=  list.to_s %>


